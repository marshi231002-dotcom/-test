<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ìºì£¼ì–¼ í¼ì¦ â€“ ë§¤ì¹˜3</title>
  <style>
    :root{
      --bg:#cfe9ff;          /* sky blue */
      --panel:#ffffffd9;     /* soft glass */
      --accent:#60d394;      /* mint */
      --accent-2:#f9a8d4;    /* pink */
      --text:#263238;        /* dark slate */
      --muted:#667085;       /* gray */
      --tile-bg:#eaf7ff;     /* cell base */
      --tile-border:#c8e2ff; /* cell border */
      --invalid:#ef4444;     /* red */
      --gold:#fbbf24;        /* amber */
    }
    *{box-sizing:border-box}
    html,body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text);
      background: linear-gradient(180deg, #bfe4ff 0%, #e7f6ff 55%, #f7ffe5 100%);
      min-height:100dvh; display:flex; align-items:center; justify-content:center; padding:20px;
    }
    /* Park hills */
    body::before, body::after{
      content:""; position:fixed; inset:auto -10% 0 -10%; height:28vh; pointer-events:none; z-index:-1; border-radius:40% 40% 0 0;
      background: radial-gradient(80% 120% at 20% 100%, #77d67a 0%, #87e187 40%, #b3f0b3 65%, #eaffea 100%);
      filter: drop-shadow(0 -6px 24px #78cc7b66);
    }
    body::after{ height:20vh; transform: translateY(10%); background: radial-gradient(80% 120% at 80% 100%, #8be18e 0%, #a1ef9f 45%, #d7ffd7 100%);} 
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans KR, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color:var(--text); background: radial-gradient(1200px 800px at 80% -20%, #0b1225 0%, #0f172a 40%, #0b1225 100%), var(--bg);
      display:flex; align-items:center; justify-content:center; padding:20px;
    }
    .wrap{ width:min(96vw, 1100px); margin:0 auto; display:grid; grid-template-columns: 1fr 520px; gap:20px; align-items:start }
    @media (max-width: 900px){ .wrap{ grid-template-columns: 1fr; } }
    @media (max-width: 520px){ .grid{
      display:grid; grid-template-columns: repeat(var(--n,8), 1fr); grid-template-rows: repeat(var(--n,8), 1fr);
      gap:8px; width:100%; height:100%; padding:10px; border-radius:22px;
      background: linear-gradient(180deg, #e7fbf0, #def5ff);
      border:1px solid #cfe4ff; box-shadow: inset 0 10px 30px #a8d7ff66, 0 10px 30px #7ad3a955;
    } .cell{
      display:flex; align-items:center; justify-content:center; border-radius:16px; border:1px solid var(--tile-border);
      background: radial-gradient(140% 160% at 30% 25%, #ffffff, #e4f6ff 40%, #dff7eb 100%);
      font-size: clamp(26px, 5.4vw, 40px); user-select:none; cursor:pointer; position:relative; overflow:hidden;
      transition: transform .08s ease, box-shadow .1s ease, filter .1s ease;
      box-shadow: 0 6px 0 #98c6ff, 0 12px 20px #8bc3ff55; /* 3D raised */
      touch-action: manipulation; -webkit-tap-highlight-color: transparent;
    }
    .cell:active{ transform:translateY(1px); box-shadow: 0 5px 0 #8bb8ff, 0 8px 16px #8bc3ff55 }
    .cell.selected{ outline:2px solid var(--accent); box-shadow: 0 0 0 3px #60d39466 inset, 0 6px 0 #98c6ff }
    .cell.pop{ animation: pop .28s ease both }
    @keyframes pop{ 0%{ transform:translateY(0) scale(1) } 40%{ transform:translateY(-2px) scale(1.15) } 100%{ transform:translateY(0) scale(1) } }
    .cell.clearing{ filter: brightness(1.2) saturate(1.2); }
    .shine{ position:absolute; inset:-40%; background:linear-gradient(60deg, transparent 40%, #ffffff33 50%, transparent 60%); transform: rotate(8deg) } .wrap{ width: 100% } .panel{
      background:linear-gradient(180deg, var(--panel), #ffffffb8); backdrop-filter: blur(10px);
      border:1px solid #dbeafe; box-shadow: 0 14px 30px #8bc3ff55, 0 2px 0 #ffffff88 inset; border-radius:22px; padding:18px 18px 14px;
    } .hud{ gap:8px } .stat{
      padding:10px 12px; border-radius:16px; border:1px solid #dbeafe; background: #ffffffcc; min-width:120px; text-align:center;
      box-shadow: 0 6px 16px #8bc3ff55, 0 1px 0 #fff inset;
    }
    .stat .label{ color:#6b7280; font-size:12px; letter-spacing:.3px }
    .stat .value{ font-size:24px; font-weight:900; margin-top:2px; color:#0f172a } }

    .panel{
      background:linear-gradient(180deg, #0f172acc, #0b1225cc); backdrop-filter: blur(8px);
      border:1px solid #1f2937; box-shadow: 0 10px 30px #0006; border-radius:20px; padding:18px 18px 14px;
    }
    .title{display:flex; align-items:center; gap:10px; font-weight:900; letter-spacing:.2px; color:#1f2937}
    .title .logo{width:16px;height:16px;border-radius:6px;background:conic-gradient(from 180deg, #60d394, #66e0ff, #f9a8d4, #ffd166, #60d394); box-shadow:0 0 12px #8de8c866}
    .subtitle{color:#556274; font-size:14px; margin-top:6px} 
    .title .logo{width:14px;height:14px;border-radius:4px;background:conic-gradient(from 180deg, var(--accent), #6366f1, #f43f5e, #f59e0b, var(--accent)); box-shadow:0 0 12px #38bdf866}
    .subtitle{color:var(--muted); font-size:14px; margin-top:4px}

    /* HUD */
    .hud{ display:flex; gap:12px; flex-wrap:wrap; margin-top:10px }
    .stat{
      padding:10px 12px; border-radius:12px; border:1px solid #1f2937; background: #0b1225bb; min-width:110px; text-align:center;
    }
    .stat .label{ color:var(--muted); font-size:12px; letter-spacing:.3px }
    .stat .value{ font-size:22px; font-weight:800; margin-top:2px }

    .actions{ display:flex; gap:10px; margin-top:10px; flex-wrap:wrap }
    button.btn{
      cursor:pointer; border:1px solid #dbeafe; background: linear-gradient(180deg, #ffffff, #f1fbff);
      color:#18323a; padding:12px 16px; border-radius:999px; font-weight:800;
      transition: transform .06s ease, box-shadow .06s ease, background .12s ease;
      box-shadow: 0 8px 0 #a8d7ff, 0 14px 24px #8bc3ff55;
    }
    button.btn:hover{ transform:translateY(-2px); box-shadow:0 10px 0 #9cd1ff, 0 20px 28px #8bc3ff66 }
    button.primary{ background: linear-gradient(180deg, #ffffff, #e7fff1); border-color:#b7f3c9 }
    button.accent{ background: linear-gradient(180deg, #ffffff, #ffeefb); border-color:#f9a8d4 }
    button.btn:hover{ transform:translateY(-1px); box-shadow:0 6px 14px #0007 }
    button.primary{ background: linear-gradient(180deg, #1f2937, #0b1225); border-color:#263244 }
    button.accent{ background: linear-gradient(180deg, #1e293b, #0b1225); border-color:#1e3a8a }

    /* Board */
    .board{ aspect-ratio:1/1; width:min(86vw, 560px); margin:auto; position:relative }
    .grid{
      display:grid; grid-template-columns: repeat(var(--n,8), 1fr); grid-template-rows: repeat(var(--n,8), 1fr);
      gap:6px; width:100%; height:100%; padding:8px; border-radius:20px; background:linear-gradient(180deg, #0b1225, #0a0f1e);
      border:1px solid #1f2937; box-shadow: inset 0 6px 30px #0007;
    }
    .cell{$1 touch-action: manipulation; -webkit-tap-highlight-color: transparent;}
    .cell:active{ transform:scale(.98) }
    .cell.selected{ outline:2px solid var(--accent); box-shadow: 0 0 0 3px #38bdf866 inset }
    .cell.pop{ animation: pop .28s ease both }
    @keyframes pop{ 0%{ transform:scale(1) } 40%{ transform:scale(1.2) } 100%{ transform:scale(1) } }
    .cell.clearing{ filter: brightness(1.8) saturate(1.3); }
    .shine{ position:absolute; inset:-40%; background:linear-gradient(60deg, transparent 40%, #ffffff18 50%, transparent 60%); transform: rotate(8deg) }

    .footer{ color:#6b7280; font-size:13px; margin-top:12px }
    .toast{
      position:absolute; inset:auto 0 10px 0; margin:auto; width:max-content; padding:10px 14px; border-radius:999px; border:1px solid #334155; background:#0b1225ee; color:#e2e8f0; font-weight:700; box-shadow:0 8px 22px #0008; display:none
    }
    .toast.show{ display:block; animation: fade .8s ease both }
    @keyframes fade{ 0%{ opacity:0; transform:translateY(6px) } 100%{ opacity:1; transform:translateY(0) } }
  @media (max-width: 900px){ .wrap{ grid-template-columns: 1fr; } }
    @media (max-width: 560px){ .grid{ gap:6px; padding:8px } .cell{ border-radius:14px; font-size: clamp(28px, 9.5vw, 48px) } .wrap{ width: 100% } .panel{ padding:14px } .hud{ gap:8px } .stat{ padding:10px 12px; min-width:unset } .actions{ gap:8px } }
  /* === THEME FIX OVERRIDES (ensures new light theme takes precedence) === */
    .panel{ background:linear-gradient(180deg, var(--panel), #ffffffcc) !important; color:var(--text) }
    .board{ width:100%; position:relative }
    .grid{ background: linear-gradient(180deg, #e7fbf0, #def5ff) !important; border:1px solid #cfe4ff !important; box-shadow: inset 0 10px 30px #a8d7ff66, 0 10px 30px #7ad3a955 !important }
    .cell{ background: radial-gradient(140% 160% at 30% 25%, #ffffff, #e4f6ff 40%, #dff7eb 100%) !important; box-shadow: 0 6px 0 #98c6ff, 0 12px 20px #8bc3ff55 !important }

  </style>
</head>
<body>
  <div class="wrap">
    <section class="panel">
      <div class="title"><span class="logo"></span> ìºì£¼ì–¼ í¼ì¦ Â· ë§¤ì¹˜3</div>
      <div class="subtitle">ì¸ì ‘í•œ íƒ€ì¼ ë‘ ê°œë¥¼ ë°”ê¿”ì„œ ê°™ì€ ëª¨ì–‘ 3ê°œ ì´ìƒì„ ê°€ë¡œ/ì„¸ë¡œë¡œ ë§ì¶”ì„¸ìš”. ì—°ì‡„ë¡œ ì ìˆ˜ë¥¼ ë…¸ë ¤ë³´ì„¸ìš”!</div>
      <div class="hud">
        <div class="stat"><div class="label">ì ìˆ˜</div><div id="score" class="value">0</div></div>
        <div class="stat"><div class="label">ë‚¨ì€ ì´ë™</div><div id="moves" class="value">30</div></div>
        <div class="stat"><div class="label">ëª©í‘œ</div><div id="target" class="value">2,000</div></div>
        <div class="stat"><div class="label">ì—°ì‡„</div><div id="chain" class="value">Ã—1</div></div>
      </div>
      <div class="actions">
        <button class="btn primary" id="newGame">ìƒˆ ê²Œì„</button>
        <button class="btn accent" id="hintBtn">íŒíŠ¸ ë³´ê¸°</button>
        <button class="btn" id="howBtn">ë°©ë²•</button>
      </div>
      <div class="footer">Tip: ê°€ëŠ¥í•œ êµí™˜ ì¤‘ ë§¤ì¹˜ê°€ ìƒê¸°ëŠ” ìŒë§Œ í—ˆìš©ë©ë‹ˆë‹¤. íŒíŠ¸ëŠ” ì ìˆ˜ íŒ¨ë„ ì•„ë˜ì— ì ê¹ í‘œì‹œë¼ìš”.</div>
    </section>

    <section class="panel board">
      <div id="toast" class="toast">ì˜ëª»ëœ ì´ë™ì´ì—ìš”</div>
      <div id="grid" class="grid" aria-label="í¼ì¦ ë³´ë“œ" role="grid"></div>
    </section>
  </div>

  <script>
    const SIZE = 8;                     // ë³´ë“œ í¬ê¸° (8x8)
    const TYPES = ["ğŸ¶","ğŸ±","ğŸ­","ğŸ¹","ğŸ°","ğŸ»"]; // ë™ë¬¼ ì–¼êµ´ ì´ëª¨ì§€ë¡œ êµì²´ // íƒ€ì¼ ì¢…ë¥˜ ì´ëª¨ì§€ë¡œ ê°„ë‹¨í•˜ê²Œ
    const SCORE_PER_TILE = 10;
    const START_MOVES = 30;
    const TARGET_SCORE = 2000;

    const gridEl = document.getElementById('grid');
    const scoreEl = document.getElementById('score');
    const movesEl = document.getElementById('moves');
    const chainEl = document.getElementById('chain');
    const toastEl = document.getElementById('toast');

    document.documentElement.style.setProperty('--n', SIZE);

    let grid = [];           // 1ì°¨ì› ë°°ì—´ë¡œ ë³´ê´€ (row*SIZE + col)
    let selected = null;     // ì„ íƒëœ ì¸ë±ìŠ¤
    let score = 0;
    let moves = START_MOVES;
    let chain = 1;           // ì—°ì‡„ ë°°ìˆ˜
    let busy = false;        // ì²˜ë¦¬ ì¤‘ ì…ë ¥ ì ê¸ˆ

    // ìœ í‹¸
    const idx = (r,c)=> r*SIZE + c;
    const rowOf = i => Math.floor(i / SIZE);
    const colOf = i => i % SIZE;
    const inBounds = (r,c)=> r>=0 && c>=0 && r<SIZE && c<SIZE;
    const randType = ()=> Math.floor(Math.random() * TYPES.length);

    function newGame(){
      score = 0; moves = START_MOVES; chain = 1; updateHUD();
      grid = new Array(SIZE*SIZE).fill(0);
      // ì´ˆê¸° ë°°ì¹˜: ì¦‰ì‹œ ë§¤ì¹˜ê°€ ìƒê¸°ì§€ ì•Šë„ë¡ ì±„ìš°ê¸°
      for(let r=0;r<SIZE;r++){
        for(let c=0;c<SIZE;c++){
          let t;
          do{ t = randType(); }
          while( (c>=2 && grid[idx(r,c-1)]===t && grid[idx(r,c-2)]===t) ||
                 (r>=2 && grid[idx(r-1,c)]===t && grid[idx(r-2,c)]===t) );
          grid[idx(r,c)] = t;
        }
      }
      render();
      // ì‹œì‘ ë°°ì¹˜ê°€ ë§‰í˜”ìœ¼ë©´ ê°•ì œë¡œ ì„ê¸°
      if (!hasAnyValidSwap()) reshuffle();
    }

    function updateHUD(){
      scoreEl.textContent = score.toLocaleString();
      movesEl.textContent = moves;
      chainEl.textContent = `Ã—${chain}`;
      document.getElementById('target').textContent = TARGET_SCORE.toLocaleString();
    }

    function render(){
      gridEl.innerHTML = '';
      grid.forEach((t, i)=>{
        const cell = document.createElement('button');
        cell.className = 'cell';
        cell.setAttribute('role','gridcell');
        cell.dataset.i = i;
        cell.innerHTML = `<div class="shine"></div>${TYPES[t]}`;
        if(selected === i) cell.classList.add('selected');
        cell.addEventListener('click', onCellClick);
        // ëª¨ë°”ì¼ ìŠ¤ì™€ì´í”„ ì§€ì›
        let sx=0, sy=0; let startI=null;
        cell.addEventListener('touchstart', (ev)=>{
          if (busy) return;
          const t = ev.touches[0]; sx = t.clientX; sy = t.clientY; startI = i;
        }, {passive:true});
        cell.addEventListener('touchend', (ev)=>{
          if (busy) return;
          const t = ev.changedTouches[0]; const dx = t.clientX - sx; const dy = t.clientY - sy;
          const dist = Math.hypot(dx,dy);
          const TH = 22; // ìŠ¤ì™€ì´í”„ ì„ê³„ê°’(px)
          if(dist < TH){ // íƒ­ì²˜ëŸ¼ ì²˜ë¦¬
            onCellClick({ currentTarget: { dataset: { i: String(i) } } });
            return;
          }
          // ë°©í–¥ ê³„ì‚° -> ì¸ì ‘ ì¹¸ìœ¼ë¡œ ë³€í™˜
          const ar=rowOf(startI), ac=colOf(startI);
          let br=ar, bc=ac;
          if(Math.abs(dx) > Math.abs(dy)) bc += (dx>0?1:-1); else br += (dy>0?1:-1);
          if(inBounds(br,bc)){
            const j = idx(br,bc);
            if(isAdjacent(startI, j)) trySwap(startI, j);
          }
        }, {passive:true});
        gridEl.appendChild(cell);
      });
    }`;
        if(selected === i) cell.classList.add('selected');
        cell.addEventListener('click', onCellClick);
        gridEl.appendChild(cell);
      });
    }

    function onCellClick(e){
      if (busy) return;
      const i = +e.currentTarget.dataset.i;
      if (selected === null){
        selected = i; render();
      } else if (selected === i){
        selected = null; render();
      } else if (isAdjacent(selected, i)){
        trySwap(selected, i);
      } else {
        selected = i; render();
      }
    }

    const isAdjacent = (a,b)=>{
      const ar=rowOf(a), ac=colOf(a), br=rowOf(b), bc=colOf(b);
      return (ar===br && Math.abs(ac-bc)===1) || (ac===bc && Math.abs(ar-br)===1);
    }

    function trySwap(a,b){
      busy = true;
      swap(a,b);
      const matches = findMatches();
      if(matches.size===0){
        // ì›ë³µ + í† ìŠ¤íŠ¸
        swap(a,b);
        toast("ë§¤ì¹˜ê°€ ìƒê¸°ì§€ ì•Šì•„ìš”!", true);
        pulseInvalid([a,b]);
        busy = false; selected = null; render();
      } else {
        // ìœ íš¨ ì´ë™
        moves--; chain = 1; updateHUD();
        selected = null; render();
        resolveBoard(matches).then(()=>{
          busy = false;
          checkEnd();
        });
      }
    }

    function swap(a,b){
      const t = grid[a]; grid[a]=grid[b]; grid[b]=t;
    }

    function findMatches(){
      const del = new Set();
      // ê°€ë¡œ
      for(let r=0;r<SIZE;r++){
        let runLen=1;
        for(let c=1;c<=SIZE;c++){
          const cur = c<SIZE ? grid[idx(r,c)] : -999;
          const prev = grid[idx(r,c-1)];
          if(c<SIZE && cur===prev){ runLen++; }
          else{ if(runLen>=3){ for(let k=1;k<=runLen;k++) del.add(idx(r,c-k)); } runLen=1; }
        }
      }
      // ì„¸ë¡œ
      for(let c=0;c<SIZE;c++){
        let runLen=1;
        for(let r=1;r<=SIZE;r++){
          const cur = r<SIZE ? grid[idx(r,c)] : -999;
          const prev = grid[idx(r-1,c)];
          if(r<SIZE && cur===prev){ runLen++; }
          else{ if(runLen>=3){ for(let k=1;k<=runLen;k++) del.add(idx(r-k,c)); } runLen=1; }
        }
      }
      return del;
    }

    function clearMatches(del){
      del.forEach(i=> grid[i] = null);
    }

    function dropAndFill(){
      // ê° ì—´ë§ˆë‹¤ ì•„ë˜ë¡œ ë‹¹ê¸°ê¸°
      for(let c=0;c<SIZE;c++){
        let wr = SIZE-1; // ì“°ê¸° ìœ„ì¹˜ (ì•„ë˜ë¶€í„°)
        for(let r=SIZE-1;r>=0;r--){
          const i = idx(r,c);
          if(grid[i]!==null){
            grid[idx(wr,c)] = grid[i];
            wr--;
          }
        }
        // ìœ„ìª½ ë¹„ëŠ” ì¹¸ ì±„ìš°ê¸°
        for(let r=wr;r>=0;r--){
          grid[idx(r,c)] = randType();
        }
      }
    }

    function animateClearing(del){
      // ê°„ë‹¨í•œ ì‹œê° íš¨ê³¼: í•´ë‹¹ ì…€ì— í´ë˜ìŠ¤ ë¶€ì—¬ í›„ ì ê¹ ê¸°ë‹¤ë¦¼
      const nodes = [...gridEl.children];
      del.forEach(i=> nodes[i]?.classList.add('clearing'));
      return wait(180);
    }

    function pulseInvalid(arr){
      const nodes = [...gridEl.children];
      arr.forEach(i=> nodes[i]?.classList.add('pop'));
      setTimeout(()=> arr.forEach(i=> nodes[i]?.classList.remove('pop')), 300);
    }

    function wait(ms){ return new Promise(res=> setTimeout(res, ms)); }

    async function resolveBoard(initialDel){
      let del = initialDel;
      while(del.size){
        await animateClearing(del);
        // ì ìˆ˜: íƒ€ì¼ ìˆ˜ Ã— ê¸°ë³¸ì ìˆ˜ Ã— ì—°ì‡„ë°°ìˆ˜
        score += del.size * SCORE_PER_TILE * chain;
        updateHUD();
        clearMatches(del);
        render();
        await wait(80);
        dropAndFill();
        render();
        await wait(120);
        del = findMatches();
        if(del.size){ chain++; updateHUD(); }
      }
      // ë§‰íˆë©´ ì„ê¸°
      if(!hasAnyValidSwap()) reshuffle(true);
    }

    function toast(text, danger=false){
      toastEl.textContent = text;
      toastEl.style.borderColor = danger ? 'var(--invalid)' : '#334155';
      toastEl.classList.add('show');
      setTimeout(()=> toastEl.classList.remove('show'), 850);
    }

    function checkEnd(){
      if(moves <= 0){
        const win = score >= TARGET_SCORE;
        const msg = win ? `ì„±ê³µ! ëª©í‘œ ë‹¬ì„± (${score.toLocaleString()}ì )` : `ì‹¤íŒ¨â€¦ ì ìˆ˜: ${score.toLocaleString()}`;
        setTimeout(()=>{
          alert(msg + "\në‹¤ì‹œ ì‹œì‘í• ê²Œìš”.");
          newGame();
        }, 250);
      }
    }

    // íŒíŠ¸: ê°€ëŠ¥í•œ ìœ íš¨ êµí™˜ ì¤‘ í•˜ë‚˜ë¥¼ ì°¾ì•„ ê°•ì¡°
    function hint(){
      for(let i=0;i<grid.length;i++){
        const neigh = neighborsOf(i);
        for(const j of neigh){
          swap(i,j);
          const ok = findMatches().size>0;
          swap(i,j);
          if(ok){
            highlight([i,j]);
            toast('ì—¬ê¸°ë¥¼ ë°”ê¿”ë³´ì„¸ìš”');
            return;
          }
        }
      }
      toast('ê°€ëŠ¥í•œ ì´ë™ì´ ì—†ì–´ ì„ìŠµë‹ˆë‹¤');
      reshuffle(true);
    }

    function neighborsOf(i){
      const r=rowOf(i), c=colOf(i), arr=[];
      if(inBounds(r,c-1)) arr.push(idx(r,c-1));
      if(inBounds(r,c+1)) arr.push(idx(r,c+1));
      if(inBounds(r-1,c)) arr.push(idx(r-1,c));
      if(inBounds(r+1,c)) arr.push(idx(r+1,c));
      return arr;
    }

    function highlight(is){
      const nodes=[...gridEl.children];
      is.forEach(k=> nodes[k]?.classList.add('selected'));
      setTimeout(()=> is.forEach(k=> nodes[k]?.classList.remove('selected')), 900);
    }

    function hasAnyValidSwap(){
      for(let i=0;i<grid.length;i++){
        for(const j of neighborsOf(i)){
          swap(i,j);
          const ok = findMatches().size>0;
          swap(i,j);
          if(ok) return true;
        }
      }
      return false;
    }

    function reshuffle(announce=false){
      // ë‹¨ìˆœ ì…”í”Œ í›„, ì‹œì‘ ë§¤ì¹˜ ì œê±° & ìœ íš¨ êµí™˜ ë³´ì¥
      let tries = 0;
      do{
        for(let i=grid.length-1;i>0;i--){
          const j = Math.floor(Math.random()*(i+1));
          const t = grid[i]; grid[i]=grid[j]; grid[j]=t;
        }
        // ì´ˆê¸° ë§¤ì¹˜ ì œê±°ìš© ì¬ë°°ì¹˜: ë§¤ì¹˜ë˜ëŠ” ì§€ì ì€ ë¬´ì‘ìœ„ êµì²´
        let del = findMatches();
        let guard=0;
        while(del.size && guard++<50){
          del.forEach(i=> grid[i] = randType());
          del = findMatches();
        }
      } while(!hasAnyValidSwap() && ++tries<40);
      render();
      if(announce) toast('ë³´ë“œë¥¼ ì„ì—ˆìŠµë‹ˆë‹¤');
    }

    // ë²„íŠ¼ë“¤
    document.getElementById('newGame').addEventListener('click', newGame);
    document.getElementById('hintBtn').addEventListener('click', hint);
    document.getElementById('howBtn').addEventListener('click', ()=>{
      alert('ê·œì¹™\n\n1) ì¸ì ‘í•œ íƒ€ì¼ ë‘ ê°œë¥¼ êµí™˜í•©ë‹ˆë‹¤.\n2) ê°€ë¡œ/ì„¸ë¡œë¡œ ê°™ì€ ëª¨ì–‘ 3ê°œ ì´ìƒì´ ì—°ê²°ë˜ë©´ ì œê±°ë˜ê³  ì ìˆ˜ë¥¼ íšë“í•©ë‹ˆë‹¤.\n3) ì œê±° í›„ ìœ„ì˜ íƒ€ì¼ì´ ë‚´ë ¤ì˜¤ë©° ë¹ˆ ì¹¸ì€ ì±„ì›Œì§‘ë‹ˆë‹¤.\n4) ì—°ì‡„ê°€ ì´ì–´ì§ˆìˆ˜ë¡ ë°°ìˆ˜ê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.\n5) ì´ë™ íšŸìˆ˜ ë‚´ì— ëª©í‘œ ì ìˆ˜ë¥¼ ë‹¬ì„±í•´ë³´ì„¸ìš”!');
    });

    // ì‹œì‘!
    newGame();
  </script>
</body>
</html>
